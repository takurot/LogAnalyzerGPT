# LogAnalyzerGPT

LogAnalyzerGPTは、Linuxシステムのログを収集・解析し、エラーや不審な活動を特定して要約します。OpenAIのGPT-4モデルを利用して、システム状態の概要を生成します。要約結果はテキストファイルとして保存されます。

## 特徴
- **ログ収集**: `/var/log`ディレクトリ内の主要なログファイルを収集。
- **エラー抽出**: `error`, `failed`, `critical`などのキーワードを使用してエラーや警告を抽出。
- **要約生成**: OpenAIのAPIを利用してログの要約を生成。
- **ファイル保存**: 生成した要約を`log_summary.txt`として保存。

---

## 必要条件
- Python 3.7以上
- OpenAI APIキー
- Linuxシステムログへの読み取りアクセス権
- Pythonライブラリ:
  - `openai`

### 依存関係のインストール
必要なライブラリをインストールするには以下を実行してください:
```bash
pip install openai
```

---

## 使用方法

### 1. リポジトリをクローン
```bash
git clone https://github.com/your_username/LogAnalyzerGPT.git
cd LogAnalyzerGPT
```

### 2. OpenAI APIキーの設定
環境変数にAPIキーを設定してください `export OPENAI_API_KEY=your_api_key`

### 3. スクリプトの実行
```bash
python3 log_analyzer_gpt.py
```

#### **ログファイルへのアクセス権の変更**

このスクリプトは、一部のシステムログファイルにアクセスするために管理者権限が必要です。ログファイルへのアクセス権を適切に設定することで、スクリプトが正常に動作するようになります。

##### **1. `sudo` 権限でスクリプトを実行する**
最も簡単な方法は、スクリプトを `sudo` 権限で実行することです。

```bash
sudo python3 log_analyzer_gpt.py
```

##### **2. 特定のユーザーにログファイルの読み取り権限を付与する**
特定のユーザー（例: スクリプトを実行するユーザー）にログファイルの読み取り権限を付与できます。

1. **読み取り権限を確認する**
   ```bash
   ls -l /var/log/boot.log
   ```

2. **読み取り権限を付与する**
   以下のコマンドで、特定のログファイルに対して読み取り権限を付与します。
   ```bash
   sudo chmod 644 /var/log/boot.log
   sudo chmod 644 /var/log/auth.log
   sudo chmod 644 /var/log/syslog
   ```

3. **変更後の権限を確認する**
   ```bash
   ls -l /var/log/boot.log
   ```

##### **3. 特定のコマンドに `sudo` をパスワードなしで実行可能にする**
システムのセキュリティを保ちながら、特定のコマンドに対して `sudo` 実行を許可できます。

1. **`sudoers` ファイルを編集する**
   ```bash
   sudo visudo
   ```

2. **以下の行を追加する**
   ```plaintext
   your_username ALL=(ALL) NOPASSWD: /usr/bin/journalctl
   ```

3. **設定を保存してスクリプトを再実行**
   スクリプト内で `journalctl` を使用してブートログを取得できます。

---

#### **セキュリティ上の注意点**
- ログファイルの権限を変更する際は、必要最小限の変更を行うことをお勧めします。
- スクリプトの実行後、権限を元に戻すことも検討してください。
  ```bash
  sudo chmod 600 /var/log/boot.log
  ```
- 可能であれば、`sudo` を用いてスクリプトを実行するほうが安全です。

### 4. 出力結果の確認
- 実行後、カレントディレクトリに`log_summary.txt`という名前のファイルが生成されます。
- ファイルには、GPTによるログの要約結果が保存されています。

#### 出力例
システムログの要約：

1. **エラーの発生**：
   - `apparmor` に関連する一連のエラーが多数記録されており、特に `snap-update-ns.firmware-updater` や `snap.firmware-updater.firmware-notifier` プロファイルが多くのファイルにアクセスできないことが記録されています。具体的には、`/proc/*/maps` や `/proc/sys/vm/max_map_count` への読み取りリクエストが拒否されています。

2. **疑わしいアクティビティ**：
   - `dockerd` とその関連サービスからのエラーメッセージ数件が見受けられ、特にポートのバインド失敗 (`address already in use`) や、コンテナが稼働していない状態でのコマンド実行に関するエラーが発生しています。これにより、正常なコンテナの起動や操作が阻害されています。

3. **将来の問題の可能性**：
   - `containerd` 構成の段階的な廃止が示唆されており、バージョン2.0への移行時に注意が必要です。これに対処しないと、将来的にスタートアップ時の問題が発生する可能性があります。
   - `gtk` ライブラリに関連するアサーション失敗が数回発生しており、GUI関連の機能に影響を及ぼす可能性があります。
   - `unattended-upgrade` プロセスに関する警告があり、マルチスレッドによるデッドロックの可能性が示唆されています。これも将来的な問題につながる恐れがあります。

このログから、アクセス拒否やサービスのエラーが多く見られ、特にアプリケーションの安定性やサービスの正常な稼働に向けて改善が必要であることがわかります。

---

## ログ解析の仕組み

1. **ログ収集**:
   以下の主要なログファイルからデータを収集します（存在する場合のみ）:
   - `/var/log/syslog`
   - `/var/log/messages`
   - `/var/log/dmesg`
   - `/var/log/auth.log`
   - `/var/log/kern.log`
   - `/var/log/cron`
   - `/var/log/secure`

2. **エラーフィルタリング**:
   キーワード（例: `error`, `failed`, `critical`など）を基に、重要なログ行のみを抽出します。

3. **ChatGPTを使用した要約**:
   OpenAIのGPT-4モデルにフィルタリングされたログを送信し、システム状態の要約を取得します。

4. **要約結果の保存**:
   要約結果を`log_summary.txt`として保存します。

---

## 注意事項

- スクリプトを実行する際は、ログファイルへの読み取りアクセス権を確認してください。
- OpenAI APIの利用には料金が発生する場合があります。
- 大量のログを送信すると、APIリクエストサイズ制限を超える可能性があります。

---

## 今後の改善点

- ログファイルの指定をコマンドライン引数でカスタマイズ可能にする。
- ログ解析後のアラート通知機能を追加。

---

## ライセンス
このプロジェクトはMITライセンスのもとで提供されています。